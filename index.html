
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Kevin Coleman</title>
  <meta name="author" content="Kevin Coleman">

  
  <meta name="description" content="If you have been programming in Rails for pretty much any length of time, you will definitely run into a method that looks like this: 1
2
3
4
5
6 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.kcoleman.me">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Kevin Coleman" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
<!--- MathJax Configuration -->
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-48081941-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Kevin Coleman</a></h1>
  
    <h2>makes apps for businesses with Ruby on Rails.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscribe" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 13.310204,73.332654 C 5.967347,73.332654 0,79.322448 0,86.621428 c 0,7.338776 5.967347,13.262246 13.310204,13.262246 7.370408,0 13.328572,-5.92245 13.328572,-13.262246 0,-7.29898 -5.958164,-13.288774 -13.328572,-13.288774 z M 0.01530612,33.978572 V 53.143878 C 12.493878,53.143878 24.229592,58.02347 33.068368,66.865306 41.894898,75.685714 46.767346,87.47449 46.767346,100 h 19.25 C 66.017346,63.592858 36.4,33.979592 0.01530612,33.978572 l 0,0 z M 0.03877552,0 V 19.17449 C 44.54796,19.17551 80.77551,55.437756 80.77551,100 H 100 C 100,44.87653 55.15102,0 0.03877552,0 z"></path></svg></a></li>
  
</ul>
  
  
  
  
  
<ul class="subscribe">
  <li><a href="https://github.com/KevinColemanInc" rel="subscribe-github" title="@KevinColemanInc on GitHub"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 50,0 C 22.385714,0 0,22.385714 0,50 0,77.614286 22.385714,100 50,100 77.614286,100 100,77.614286 100,50 100,22.385714 77.614286,0 50,0 z m 29.692858,79.692858 c -3.859184,3.859182 -8.351022,6.887754 -13.35,9.00306 -1.27041,0.536736 -2.560204,1.009184 -3.867348,1.415306 v -7.493878 c 0,-3.938774 -1.35102,-6.835714 -4.053062,-8.690816 1.692858,-0.163264 3.24694,-0.390816 4.663266,-0.683672 1.416326,-0.292858 2.913266,-0.716328 4.491838,-1.27041 1.57857,-0.55408 2.994896,-1.213264 4.247958,-1.97755 1.253062,-0.765306 2.458164,-1.758164 3.613266,-2.978572 1.155102,-1.220408 2.12449,-2.604082 2.905102,-4.15 0.780612,-1.545918 1.4,-3.40204 1.855102,-5.566326 0.455102,-2.164286 0.683674,-4.54898 0.683674,-7.153062 0,-5.045918 -1.643878,-9.341836 -4.931634,-12.890816 C 77.44796,33.35 77.285714,29.10204 75.463266,24.512244 l -1.22143,-0.145918 c -0.845918,-0.09796 -2.368366,0.260204 -4.565306,1.07449 -2.196938,0.814286 -4.663264,2.14796 -7.396938,4.004082 -3.87449,-1.07449 -7.893878,-1.611224 -12.061224,-1.611224 -4.19898,0 -8.203062,0.536734 -12.012246,1.611224 -1.72449,-1.17245 -3.361224,-2.139796 -4.907142,-2.905102 C 31.753062,25.77449 30.516326,25.254082 29.587756,24.97653 28.660204,24.7 27.79796,24.528572 27,24.463266 c -0.79796,-0.0653 -1.310204,-0.08062 -1.537756,-0.04898 -0.22755,0.03164 -0.390816,0.0653 -0.487754,0.09796 -1.82347,4.62245 -1.985714,8.87143 -0.487756,12.743878 -3.287754,3.54796 -4.931632,7.844898 -4.931632,12.890816 0,2.604082 0.227552,4.988776 0.683674,7.153062 0.456122,2.164286 1.07449,4.020408 1.855102,5.566326 0.780612,1.545918 1.75,2.929592 2.905102,4.15 1.155102,1.220408 2.360204,2.213266 3.613264,2.978572 1.253062,0.766326 2.669388,1.42449 4.24796,1.97755 1.578572,0.554082 3.07551,0.976532 4.491836,1.27041 1.416328,0.292856 2.970408,0.521428 4.663266,0.683672 -2.669388,1.82347 -4.004082,4.720408 -4.004082,8.690816 v 7.639796 C 36.536734,89.818368 35.083674,89.3 33.656122,88.695918 c -4.99898,-2.115306 -9.490816,-5.143878 -13.35,-9.00306 -3.859184,-3.859184 -6.887754,-8.351022 -9.00306,-13.35 C 9.1163263,61.171428 8.0071428,55.67347 8.0071428,50 c 0,-5.67347 1.1091835,-11.171428 3.2969392,-16.342858 2.115306,-4.998978 5.143878,-9.490816 9.00306,-13.35 3.859184,-3.859182 8.351022,-6.887754 13.35,-9.00306 C 38.828572,9.1163266 44.32653,8.0071428 50,8.0071428 c 5.67347,0 11.171428,1.1091838 16.342858,3.2969392 5,2.115306 9.490816,5.143878 13.35,9.00306 3.859182,3.859184 6.887754,8.351022 9.00306,13.35 2.186736,5.17245 3.295918,10.67041 3.295918,16.342858 0,5.672448 -1.109182,11.171428 -3.296938,16.342858 -2.115306,4.998978 -5.143878,9.490816 -9.00204,13.35 l 0,0 z"></path></svg></a></li>
</ul>
  
  
  
  
  
<ul class="subscribe">
  <li><a href="https://plus.google.com/+KevinColemanInc" rel="publisher" title="Google+ Profile"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 23.03264,55.19021 C 32.01805,55.457578 38.046082,46.137447 36.495958,34.370183 34.943794,22.603939 26.398215,13.161349 17.411784,12.89296 8.4253533,12.625592 2.3973217,21.630392 3.9494863,33.400718 5.5006303,45.164921 14.043148,54.921821 23.03264,55.19021 z M 99.99898,24.999027 100,0 -0.00797206,0 0.0052943,16.202408 C 5.7047282,11.184661 13.611481,6.9914696 21.771315,6.9914696 c 8.721103,0 34.888495,0 34.888495,0 l -7.807765,6.6035874 -11.062106,0 c 7.33732,2.81349 11.246815,11.3407 11.246815,20.090377 0,7.348545 -4.082979,13.667416 -9.852826,18.161652 -5.629021,4.385043 -6.696453,6.220904 -6.696453,9.948752 0,3.180866 6.030073,8.594563 9.183386,10.81923 9.217061,6.498477 12.199952,12.530591 12.199952,22.603843 0,1.604209 -0.198996,3.206378 -0.591884,4.780993 L 100,100 c 0,0 0,-46.594917 0,-68.751495 l -18.750474,0 0,18.750475 -6.250499,0 0,-18.750475 -18.750474,0 0,-6.250498 18.750474,0 0,-18.7494538 6.250499,0 0,18.7494538 18.750474,0 z M 18.147557,74.798916 c 2.111393,0 4.04522,-0.05817 6.048441,-0.05817 -2.651232,-2.571634 -4.749358,-5.722905 -4.749358,-9.606889 0,-2.305285 0.738834,-4.52485 1.77157,-6.496436 -1.053145,0.0745 -2.127721,0.09695 -3.234952,0.09695 -7.261803,0 -13.4286215,-2.351208 -17.99020957,-6.236212 l 0,6.56685 0.00102048,19.70055 C 5.2128523,76.28781 11.409265,74.798916 18.147557,74.798916 z M 44.474145,93.051391 C 43.002599,87.308076 37.788918,84.46091 30.518951,79.420713 c -2.644088,-0.85313 -5.556565,-1.35521 -8.681304,-1.387866 -8.752739,-0.09389 -17.2452523,3.525266 -21.84561906,8.743028 l 0,13.224125 44.64641606,-0.0011 c 0,0 0.263286,-2.21038 0.263286,-3.362512 -10e-4,-1.222547 -0.151032,-2.419581 -0.427585,-3.58498 z"></path></svg></a></li>
</ul>
  
  
  
    
      <form action="https://google.com/search" method="get">
        <fieldset role="search">
          <input type="hidden" name="q" value="site:www.kcoleman.me" />
    
          <input class="search" type="text" name="q" results="0" placeholder="Search"/>
        </fieldset>
      </form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/coleman-laws">Coleman Laws</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/12/ruby-tip-returning/">Rails Tip: Returning</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-12T13:35:15-07:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:35 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/house.jpg" title="Rails tip: Returning" class="banner-img"  /></p>

<p>If you have been programming in Rails for pretty much any length of time, you will definitely run into a method that looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">some_method</span>
</span><span class='line'>  <span class="n">foo</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>  <span class="n">foo</span> <span class="o">&lt;&lt;</span> <span class="no">Cat</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="n">foo</span> <span class="o">&lt;&lt;</span> <span class="no">Dog</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">foo</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>You initiate some local variable, do some things to it, then return it.</p>

<p>There is a lot of boiler plate code here and the smart developers behind rails added a method to the object class called returning.  This method simplifies this workflow.  Here is an example of the returning method in action.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">some_method</span>
</span><span class='line'>  <span class="n">returning</span> <span class="n">foo</span> <span class="o">=</span> <span class="o">[]</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">foo</span> <span class="o">&lt;&lt;</span> <span class="no">Cat</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">foo</span> <span class="o">&lt;&lt;</span> <span class="no">Dog</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is a much more elegant solution since it just reads more like a sentence than the previous example.  &ldquo;Add Cat and Dog to foo then return&rdquo; vs &ldquo;create foo. Add Cat and Dog. return foo&rdquo;.  Ruby&rsquo;s ability to easily add DSL to objectss on the fly makes ruby so powerful and easy to maintian.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/10/rails-tips-fast-relation-detection/">Rails Tips: Fast Relation Detection</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-10T08:15:04-07:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:15 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/cafe.jpg" title="Rails tips: Fast Relation Detection" class="banner-img"  /></p>

<p>When working with active_record, you often need to establish if a row exists to see if you can do operations against it.  Here is an interesting technique when checking if objects or relations exist in a collection.</p>

<p>Many developers use the <code>present?</code> method, but this is bad practice, because it performs a standard <code>SELECT</code> query against your table which, relative to a count, is very slow.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">blog</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">present?</span>
</span><span class='line'><span class="c1"># SELECT id FROM `posts` WHERE (&quot;posts&quot;.blog_id = 1)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The better trick would be to use the <code>exits?</code> method to more efficiently determine if a record exists since it just has to return a number instead of a large collection of objects</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">blog</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">exists?</span>
</span><span class='line'><span class="c1"># SELECT id FROM `posts` WHERE (&quot;posts&quot;.blog_id = 1) LIMIT 1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Alternatively, if you know you are going to need the object later, it is better to just load exactly what you need and use it later:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">if</span> <span class="n">blog</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'><span class="c1"># SELECT id FROM `posts` WHERE (&quot;posts&quot;.blog_id = 1)</span>
</span><span class='line'>  <span class="n">do_something_with_posts</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">posts</span><span class="p">)</span>
</span><span class='line'>  <span class="c1"># No query</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you had done a exists or a count on the post, then you would have to run back to the database to fetch the rest of the objects.  While this is more memory intensive, it can be much faster technique.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/09/regex-escaping-slashes/">Regex: Escaping Slashes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-09T07:49:01-07:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:49 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/buildings.jpg" title="Regex: Escaping Slashes" class="banner-img"  /></p>

<p>Escaping slashes in can leave regex expressions difficult to read.  A regex statement that is meant to identify a url like this one <code>http://atdc.org/wp-admin/admin-ajax.php</code>.</p>

<p>would look something like this using the standard <code>/expression/</code> notation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/http:\/\/atdc.org\/wp-admin\/admin-ajax.php/</span></code></pre></td></tr></table></div></figure>


<p>But if you use the <code>%r{expression}</code> notation, then your regex expressions do not need to be muddled with escaping slashes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>%r{http://atdc.org/wp-admin/admin-ajax.php}</span></code></pre></td></tr></table></div></figure>


<p>Much easier to read :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/08/limited-retry-pattern/">Limited Retry Pattern</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-08T23:43:12-07:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:43 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/horse_statue.jpg" title="Limited Retry Pattern" class="banner-img" /></p>

<p>The limited retry pattern is a great tool for retrying method calls a limited number of times.  In instances where I want to make an API with a limited number of tries. I would have my method look like this:</p>

<figure class='code'><figcaption><span>limited_retry.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">api_call</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@retries</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">begin</span>
</span><span class='line'>    <span class="n">do_api_call</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="no">ApiError</span><span class="p">,</span> <span class="no">Timeout</span>
</span><span class='line'>    <span class="vi">@retries</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">retry</span> <span class="k">if</span> <span class="vi">@retries</span> <span class="o">&lt;</span> <span class="mi">5</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The retry method is really powerful in ruby.  If a block is rescued, by calling &ldquo;retry&rdquo; it will attempt to run that block again.  For example, if your server has a spotty connection, it would make sense to retry an API request twice if it failed to reach the server.</p>

<p>The <a href="https://github.com/DiegoSalazar/DefRetry">DefRetry gem</a> by DiegoSalazar can be used to add DSL to your ruby classes that you want to retry a few times.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/23/queable-concern/">Adding Queues to Your Models</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-23T21:54:42-07:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>9:54 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/bird_statue.jpg" title="Adding Queues to your models" class="banner-img" /></p>

<p>At work recently, we needed to introduce the concept of a queue into our rails app.  MySQL really doesn&rsquo;t do a great job with these types of things, because it is so slow.  Redis is a much better solution, because its speed and ease of use.</p>

<p>I built the queueing concern on top of RedisObjects, because it has such a great DSL wrapper for storing ruby types into redis.  The main feature I use is their list object.</p>

<figure class='code'><figcaption><span>queueable.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Queueable</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">included</span> <span class="k">do</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">Redis</span><span class="o">::</span><span class="no">Objects</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># more code here</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This adds Redis::Objects to the models that I use this concern on so I can leverage their list DSL method.</p>

<p>In my model, I want to write my own DSL to make it super easy for me to create new queue attributes in all of my models.  I want to be able to just do this in my model:</p>

<figure class='code'><figcaption><span>user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Queueable</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">queue</span> <span class="ss">:scoring_queue</span>
</span><span class='line'>  <span class="n">queue</span> <span class="ss">:email_queue</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>For the purposes of my application, I needed to be able to:</p>

<ul>
<li>rotate the queue, such that the top element returned and is moved to the bottom of the queue.</li>
<li>set the entire queue to something new.</li>
<li>re-queue a element, so that if it exists in my queue, it gets sent to the bottom.</li>
</ul>


<figure class='code'><figcaption><span>user_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">UserController</span> <span class="o">&lt;</span> <span class="no">ActiveController</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="n">next_score</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">rotate_scoring_queue</span> <span class="c1">#gets the top element and moves it to the bottom</span>
</span><span class='line'>    <span class="n">user</span><span class="o">.</span><span class="n">requeue_scoring_queue</span> <span class="n">invited_score</span> <span class="c1"># moves this score to the bottom of the queue</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To accomplish this, I use a meta programming to dynamically create these methods.  The <code>define_method</code> in ruby is an extremely powerful concept that allows developers to create methods based with dynamic names.</p>

<figure class='code'><figcaption><span>queueable.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">class_methods</span> <span class="k">do</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">queue</span><span class="p">(</span><span class="n">queue_name</span><span class="p">)</span>
</span><span class='line'>      <span class="n">list</span> <span class="n">queue_name</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">define_method</span><span class="p">(</span><span class="s2">&quot;rotate_</span><span class="si">#{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">queue_list</span> <span class="o">=</span> <span class="nb">send</span><span class="p">(</span><span class="n">queue_name</span><span class="p">)</span>
</span><span class='line'>        <span class="n">queue_list</span><span class="o">.</span><span class="n">rpoplpush</span> <span class="n">queue_list</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">define_method</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">=&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">vals</span><span class="o">|</span>
</span><span class='line'>        <span class="n">queue_list</span> <span class="o">=</span> <span class="nb">send</span><span class="p">(</span><span class="n">queue_name</span><span class="p">)</span>
</span><span class='line'>        <span class="no">Redis</span><span class="o">::</span><span class="no">Objects</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">multi</span> <span class="k">do</span>
</span><span class='line'>          <span class="n">queue_list</span><span class="o">.</span><span class="n">clear</span>
</span><span class='line'>          <span class="n">queue_list</span><span class="o">.</span><span class="n">push</span> <span class="o">*</span><span class="n">vals</span><span class="o">.</span><span class="n">reverse</span> <span class="k">if</span> <span class="n">vals</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">define_method</span><span class="p">(</span><span class="s2">&quot;requeue_</span><span class="si">#{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">target</span><span class="o">|</span>
</span><span class='line'>        <span class="n">queue_list</span> <span class="o">=</span> <span class="nb">send</span><span class="p">(</span><span class="n">queue_name</span><span class="p">)</span>
</span><span class='line'>        <span class="n">number_removed</span> <span class="o">=</span> <span class="n">queue_list</span><span class="o">.</span><span class="n">delete</span> <span class="n">target</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">if</span> <span class="n">number_removed</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">last_item_in_queue</span> <span class="o">=</span> <span class="n">queue_list</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">last_item_in_queue</span>
</span><span class='line'>          <span class="n">queue_list</span><span class="o">.</span><span class="n">insert</span> <span class="ss">:before</span><span class="p">,</span> <span class="n">last_item_in_queue</span><span class="p">,</span> <span class="n">target</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>          <span class="n">queue_list</span><span class="o">.</span><span class="n">push</span> <span class="n">target</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first line <code>def queue</code> adds in my DSL method to the model to allow queues with a given name to be created.</p>

<p>Unfortunately RedisObjects doesn&rsquo;t come with an out of the box way to set an entire list at once.  So I had to write my own using Redis transactions.  So the second method overrides the setter method of the list to accept an array of values that we will set.</p>

<p>The re-queue method removes a target value from the queue.  Then it sets it to the queue, if it can&rsquo;t find a last item (then that means it was the only item in the queue), it adds it back to the list.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/10/hosting-side-projects/">Hosting Side Projects for Free</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-10T19:33:59-07:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:33 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/czech_2.jpg" title="Hosting Side Projects for Free" class="banner-img img-responsive"/></p>

<p>With <a href="https://blog.heroku.com/archives/2015/5/7/new-dyno-types-public-beta">Heroku&rsquo;s latest pricing restructure announcement</a>, I decided it was time to re-evaluate my <a href="/projects">side-project</a> hosting strategies.  Historically, <a href="http://heroku.com">Heroku</a> has been my go to as a hosting provider for my various rails application endeavors, because it is so easy to setup and, most importantly, free.</p>

<p>Previously my strategy for free hosting on Heroku without any server sleeping was to configure <a href="http://newrelic.com">new relic</a> to measure server uptime.  This was a great trick to keep your Heroku server from sleeping and it let you keep an eye out for server down time.  I shall be sad to see that go :(.</p>

<p>My new recipe for creating new side project deployments is as follows:</p>

<h1>Buying a domain for free</h1>

<p>With the new <a href="http://www.newtldlist.com/">influx of TLD extensions</a>, many registrars are heavily discounting these new extensions in order to encourage main stream adoption.  You can snag a new domain name for dirt cheap, and often free, using one of these new domain extensions.</p>

<p>If you are still a student or still have a .edu email address (thanks, <a href="http://gatech.edu">Georgia Tech</a>!), you can register a .me domain for free and/or a heavily discounted .com or .io domain using <a href="https://education.github.com/pack">Github.com&rsquo;s education pack</a>.</p>

<p>Checkout <a href="http://register.science">register.science</a>, <a href="http://register.party">register.party</a>, and get on the <a href="http://www.alpnames.com/">Alpnames mailing list</a> to be notified of when free domain names are available for registration.</p>

<h1>Hosting</h1>

<h2>Heroku (free-ish)</h2>

<p>You can stick with Heroku dyno&rsquo;s but like I said before, they are no longer allow websites to be active 24 per day.  Heroku will still be my go to for scheduled rake tasks, or anything that doesn&rsquo;t need to be awake all day since it is so easy to deploy to.</p>

<p>Heroku also has great free database hosting for side projects.  As long as your db doesn&rsquo;t exceed 10,000 rows, Heroku will host it for free and give you a nice interface to run queries on.</p>

<h2>Apigee (free)</h2>

<p><a href="https://apigee.com/docs/api-services/content/what-apigee-edge">Apigee Edge</a> promises a lot of really <a href="https://apigee.com/about/pricing/apigee-edge-pricing-features">nice features</a> for their developer accounts: a buttload of storage space, unlimited bandwidth, and api analytics.  The big gotcha&rsquo;s though are they only host nodejs applications and their documentation is terrible.  <del>Once</del> if you can figure out how to get your website running, it is pretty simple to maintain, but getting it up there may take hours.  I used them for the <a href="http://challengepost.com/software/sentimus-edegx">Sears Hackathon</a> and the struggle was real.</p>

<p>You can also do some pretty sweet stuff with combining api&rsquo;s into new apis.  They also have a service that competes with Parse for managing mobile app data, but again, the documentation is terrible.  Good luck.</p>

<h2>Github pages (free)</h2>

<p>I host this blog on <a href="http://pages.github.com">Github pages</a> and build things with <a href="http://octopress.org/">Octopress</a>.  Deployments and settings things up are a breeze, but github only hosts static content.</p>

<p>A small part of me is considering moving <a href="http://AtlantaStartupJobs.com">AtlantaStartupJobs.com</a> to github, because the content there only changes once per day.  I would just need to write ruby tasks to grab the latest Atlanta start up jobs, generate the html for them, and then push up to Github.</p>

<p>Since it is static, there is not backend database other than static hosting .json files, which could be a thing&hellip;</p>

<h2>Amazon Web Services (free-ish)</h2>

<p>For one year, you can utilize the basics of <a href="http://aws.amazon.com">AWS</a> for free.  One big catch here is setting up AWS servers and configuring them can be a weekend project on its own, unless you are familiar with devops.  It is not where near as simple as Heroku and you are limited by the resources of one ec2 machine.  It doesn&rsquo;t scale well if you plan on hosting a bunch of different projects.</p>

<p>AWS has <a href="https://aws.amazon.com/rds/">RDS</a> which makes it super easy to throw up a database.  They support <a href="https://www.mysql.com/">mysql</a>, <a href="http://www.postgresql.org/">postgres</a>, and a few others.</p>

<h2>OpenShift (use this one!)</h2>

<p><a href="http://openshift.com">OpenShift</a> seems like the best drop in replacement for Heroku.  They have a free tier with reasonably powerful servers.  Unfortunately the database shares the same limited resources the application server utilizes, so you get a bit less than 1GB of storage space for your application and database to share.</p>

<p>My strategy here is to keep my Heroku database up and just configure my OpenShift application to connect directly to the Heroku one, so I don&rsquo;t have to deal with shared resources.  This may make my website a little bit slower, but it should be good enough.</p>

<h2>Cloud99</h2>

<p>I have heard bad stories about <a href="http://www.cloud66.com/">Cloud99</a> and they were <a href="https://news.ycombinator.com/item?id=5685406">hacked a few years ago</a>, plus they are not free.  My advice is to stay away.</p>

<h1>Free email</h1>

<p>Having an @gmail.com account as the linked support email for your side project is so not classy.  You can configure your free custom domain with <a href="http://zoho.com">Zoho</a> and be able to email your customers from a more legit looking domain.  Be sure to configure your MX records properly so your new domain doesn&rsquo;t get sent to the spam folder.</p>

<h1>Free transactional email sending</h1>

<p>I really like <a href="http://mandrill.com">Mailchimp&rsquo;s Mandrill</a>.  I have been using them for years and haven&rsquo;t had any problems.  They offer a generous number of emails sent (10k) to be exact and don&rsquo;t limit their services in features, just mailing volume.</p>

<h1>Free SSL certs</h1>

<p>Another sweet trick you can do for your side project websites is to use <a href="http://cloudflare.com">Cloudflare</a> to deliver valid SSL certificates for your projects.  From an SEO perspective, google loves SSL and from a safety and privacy perspective users love SSL.  You can read up on how to do with <a href="https://www.benburwell.com/posts/configuring-cloudflare-universal-ssl/">here</a>.</p>

<p>It took me 15 minutes to configure <a href="/">kcoleman.me</a> and <a href="http://AtlantaStartupJobs.com">AtlantaStartupJobs.com</a> to be behind Cloudflare.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/06/adding-search-to-atlanta-startup-jobs/">Adding Search to Atlanta Startup Jobs</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-06T05:23:14-07:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:23 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/czech_1.jpg" title="Adding search to Atlanta Startup Jobs" class="banner-img"/></p>

<p>I found a few minutes today to finally add search to <a href="http://atlantastartupjobs.com">Atlanta Startup Jobs</a>.  I had been putting it off for a long time, thinking it would be a long laborous process, but I found it was shockingly easy.  Here is what I did:</p>

<h2>Install pg_search</h2>

<p>The two leading gems that drive postgress fulltext search are <a href="https://github.com/Casecommons/pg_search">pg_search</a> and <a href="https://github.com/textacular/textacular">textacular</a>.  I went with pg_search, because it has more love on github.</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;pg_search&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and run bundle</p>

<figure class='code'><figcaption><span>console</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">  bundle</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Modify model</h2>

<p>For the models you want to search, add <code>include PgSearch</code> to the top of them in order to enable the pg_search DSL.  Since <a href="http://atlantastartupjobs.com">Atlanta Startup Jobs</a> only has one searchable model (job_posts), I include this line in the model:</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">pg_search_scope</span> <span class="ss">:search_generic</span><span class="p">,</span> <span class="ss">:against</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:company_name</span><span class="p">,</span> <span class="ss">:description</span><span class="o">]</span><span class="p">,</span> <span class="ss">:order_within_rank</span> <span class="o">=&gt;</span> <span class="s2">&quot;created_at DESC&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I included the &ldquo;order_within_rank&rdquo;, to protect the order across different pages, since postgres randomly ranks items with equivalent rank score.</p>

<h2>Modify controller</h2>

<p>Here is what my search action looks like in my controller code:</p>

<figure class='code'><figcaption><span>job_posts_controller</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">search</span>
</span><span class='line'>  <span class="vi">@job_posts</span> <span class="o">=</span> <span class="no">JobPost</span><span class="o">.</span><span class="n">search_generic</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:q</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">page</span> <span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span>
</span><span class='line'>  <span class="n">render</span> <span class="ss">:index</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/03/rails-patterns-builders-and-models/">Rails Patterns: Builders and Models</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-03T00:23:38-07:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>12:23 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/sf-bridge.jpg" title="Rails Patterns: Builders and Models" class="banner-img"/></p>

<p>A huge problem with ruby on rails apps is many of them end with overly cluttered models and controller methods. An attempt to solve this would be to move what you can to your active record models, but then you end up with heavily bloated model classes that extend way beyond their intended active record design patterns.  Active record models should just manage the communication between the rails app and the database.  Anything else is just code smell.</p>

<p>In all of my experience with rails projects, I found that my active record models typically ended up having a group of methods that helped me create the model itself (think when you create a user, you also need to create a user_profile or if you want to find or create a model).</p>

<h1>Builders</h1>

<p>You can easily break this type of code away from the model by following a builder pattern. Builder patterns are great for creating objects with business logic based on given parameters.  It adds an easy way to add business logic to model creation without adding bloat to your active record model class.</p>

<p>To follow this pattern, create a directory called <code>builders</code> in the <code>/models</code> directory.</p>

<p>Here is an example of my user class before and after a refactor with the builder pattern.</p>

<p>before:</p>

<figure class='code'><figcaption><span>user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_admin_user</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_or_create_by</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">user</span><span class="o">.</span><span class="n">add_role</span> <span class="ss">:admin</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_staff_user</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_or_create_by</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">user</span><span class="o">.</span><span class="n">add_role</span> <span class="ss">:staff</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_user_with_invite</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_or_create_by</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">user</span><span class="o">.</span><span class="n">send_invitation</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>after:</p>

<figure class='code'><figcaption><span>user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1"># nothing to see here</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>/builders/user_builder.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">Builders</span><span class="o">::</span><span class="no">UserBuilder</span>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_admin_user</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span>
</span><span class='line'>      <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_or_create_by</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span><span class='line'>      <span class="n">user</span><span class="o">.</span><span class="n">add_role</span> <span class="ss">:admin</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_staff_user</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span>
</span><span class='line'>      <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_or_create_by</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span><span class='line'>      <span class="n">user</span><span class="o">.</span><span class="n">add_role</span> <span class="ss">:staff</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_user_with_invite</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span>
</span><span class='line'>      <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_or_create_by</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span><span class='line'>      <span class="n">user</span><span class="o">.</span><span class="n">send_invitation</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Non-AR models</h1>

<p>Models also can get bloated with controller-like actions that have groups of methods that should be broken out into their own classes that the controllers will leverage.  An example of this type of class would be one that manages to send an email to a user.  These models don&rsquo;t extend active record, because they focus is performing business logic on active_record models, not storing them in the database.  Models take in a limited scope of the Params of a request, perform their function, and then return their results to the controller.</p>

<p>Before breaking out email sending, active record models would end up with a collection of email sending methods (send_password_reset, send_notification, etc). All of these should be moved to a model classes because classes have one purpose and active record models are for Savin data, not sending emails.</p>

<p>An example of this could be:</p>

<figure class='code'><figcaption><span>user_invitor.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">UserInvitor</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">invite_email</span> <span class="n">email</span>
</span><span class='line'>      <span class="no">Invitation</span><span class="o">.</span><span class="n">create</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span>
</span><span class='line'>      <span class="no">UserMailer</span><span class="o">.</span><span class="n">invite_email</span><span class="p">(</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_later</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/07/Ruby-on-Rails-Grape-gem/">Ruby on Rails Grape Gem: Pros and Cons</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-07T01:36:51-07:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:36 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/grapes.jpeg" title="Ruby on Rails Grape gem" class="banner-img" /></p>

<p>Ruby on Rails is a very powerful framework that is awesome at building RESTful APIs.  Using vanilla rails to build an API, while completely possible, is not always the best way to go.  <a href="https://github.com/intridea/grape">Grape</a> is micro-api framework design to work along side rails for developing an RESTful API.</p>

<p>Grape has some very <a href="https://github.com/intridea/grape/blob/master/README.md">expansive documentation</a> describing how the gem works, so I am not going to dive too deeply into that</p>

<h2>Pros</h2>

<p>Starting off with the positives: grape is great a creating and maintaining documentation.  I love the <a href="https://github.com/tim-vandecasteele/grape-swagger">grape-swagger</a> gem allows you to easily generate documentation from you existing code base.  Since the documentation is generated, all of the code is self-documenting and you don&rsquo;t have to maintain <a href="http://raml.org/">separate API documentation files</a>.</p>

<p>Because grape has its own <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>, it makes creating APIs easy to read and understand.  This makes the code base easier to maintain for future improvements.  Plus it has its own opinion for how to create an API, which really help keep your codebase consistent.</p>

<p>grape gives you a uniform way to control API HTTP Headers.  Rather than having to roll your own classes to manage the response headers, grape makes it easy to set them.</p>

<h2>Cons</h2>

<p>Because grape is independent of rails, it takes a bit of finagling for it to play well with rails.  You have to manually include rails libraries like ActiveRecord or ActiveSupport.  Since there is no ActiveSupport, it makes caching responses more difficult than it should be.</p>

<p>Because grape has its own DSL, there is a bit of a learning curve to understand how it wants you to create an API.  If you have a firm understanding of ruby, it shouldn&rsquo;t be that difficult for you to pick up, but it definitely takes a bit of getting used to.</p>

<p>While grape makes it easier to read and write your api, it does add another layer of complexity to your rails application.</p>

<h2>Conclusion</h2>

<p>For now, I am going to stick with rolling my own APIs using &ldquo;just&rdquo;* the rails framework.  Being more pure rails, gives me more control over the api had has less &ldquo;magic.&rdquo;  If I need to bring on a new developer, they will not have to spend as much time getting up to speed on this new library.</p>

<p>Plus, vanilla rails has an awesome caching tools that don&rsquo;t need to be arm wrestled into the framework.</p>

<ul>
<li>By &ldquo;just&rdquo; I mean, standard gem stack provided in rails 4.2 with typical basic additions I would use in both grape and vanilla rails.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/12/android-app-architecture/">Otto Meet Retrofit: How to Build a Scalable and Performant Android Application</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-12T12:46:43-07:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:46 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/beach2.jpg" title="Otto meet Retrofit: How to build a scalable and performant Android application" class="banner-img"  /></p>

<p>Unlike Ruby on Rails, Android app development does not have as definitive of an opinion on how apps should be developed and so we have designed our own pattern leveraging open source tools like <a href="http://square.github.io/otto/">Otto</a> and <a href="http://square.github.io/retrofit/">Retrofit</a> to design our applications.</p>

<p>After much research, we at <a href="http://sparkstart.io">Spark Start</a> invested in developing a design pattern for our client applications that leverages the best practices.  Jumping right in here:</p>

<h2>Consuming a RESTful API</h2>

<p>Following Object Oriented Programming&rsquo;s best practices, all objects should each only have one job.  With the start of a new api, create a folder with the name of the API you are trying to consume.</p>

<p>Inside of your client.java file, you will include your retrofit interface classes.  This file will specify how your app will be calling the API.</p>

<figure class='code'><figcaption><span>APIClient.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">APIClient</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">interface</span> <span class="nc">IUser</span> <span class="o">{</span>
</span><span class='line'>        <span class="nd">@GET</span><span class="o">(</span><span class="s">&quot;/users/Me.json&quot;</span><span class="o">)</span>
</span><span class='line'>        <span class="kt">void</span> <span class="nf">getMe</span><span class="o">(</span><span class="n">Callback</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">callback</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@GET</span><span class="o">(</span><span class="s">&quot;/users.json&quot;</span><span class="o">)</span>
</span><span class='line'>        <span class="kt">void</span> <span class="nf">getUsers</span><span class="o">(</span><span class="n">Callback</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="n">callback</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This keeps all of our API information in one small maintainable file.  Notice how we are always using the retrofit callback method instead of the async call.  This will allow our code to start a web request on any thread.  Now the code consuming this will never have to worry about thread locking.</p>

<figure class='code'><figcaption><span>APIManager.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">APIManager</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Bus</span> <span class="n">mBus</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">CooleafAPIManager</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Bus</span> <span class="n">bus</span><span class="o">)</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="n">mBus</span> <span class="o">=</span> <span class="n">bus</span><span class="o">;</span>
</span><span class='line'>        <span class="n">mAsyncRestAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RestAdapter</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
</span><span class='line'>                <span class="o">.</span><span class="na">setEndpoint</span><span class="o">(</span><span class="n">API_URL</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">setRequestInterceptor</span><span class="o">(</span><span class="n">getCookieInterceptor</span><span class="o">())</span>
</span><span class='line'>                <span class="o">.</span><span class="na">setLogLevel</span><span class="o">(</span><span class="n">RestAdapter</span><span class="o">.</span><span class="na">LogLevel</span><span class="o">.</span><span class="na">BASIC</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Subscribe</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoadAuthenticateEvent</span><span class="o">(</span><span class="n">LoadAuthenticateEvent</span> <span class="n">loadAuthenticateEvent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">String</span> <span class="n">email</span> <span class="o">=</span> <span class="n">loadAuthenticateEvent</span><span class="o">.</span><span class="na">getEmail</span><span class="o">();</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">loadAuthenticateEvent</span><span class="o">.</span><span class="na">getPassword</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Callback</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">callback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;()</span> <span class="o">{</span>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">success</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span> <span class="n">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">mBus</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="nf">LoadedMeEvent</span><span class="o">(</span><span class="n">user</span><span class="o">));</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">failure</span><span class="o">(</span><span class="n">RetrofitError</span> <span class="n">retrofitError</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">mBus</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="nf">LoadedErrorEvent</span><span class="o">(</span><span class="n">retrofitError</span><span class="o">));</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">};</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">sClient</span><span class="o">.</span><span class="na">authenticate</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">password</span><span class="o">,</span> <span class="n">deviceID</span><span class="o">,</span> <span class="n">callback</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The manager class acts as a middleware between the client and the rest of our application.  For our <a href="http://cooleaf.com">most recent application</a>, authentication is handled by cookies, so we had to create our own cookie interceptor to handle authentication.</p>

<p>The manager class subscribes to the bus and watches for events that request an API call.  When a user needs to authenticate, it catches the event, creates a callback which will intern fire off a new event once the response is finished.</p>

<h2>Hooking in Otto into the controller classes</h2>

<p>Otto is a great tool for managing async task events.  It has an event bus that you subscribe and unsubscribe your fragments and activities to, so when a callback (e.g. Retrofit is finished with a request), they can process the response.</p>

<figure class='code'><figcaption><span>LoginFragment.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>       <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
</span><span class='line'>       <span class="n">BusProvider</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
</span><span class='line'>        <span class="n">BusProvider</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">unregister</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">onLoginClick</span><span class="o">()</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="n">BusProvider</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="nf">LoadAuthenticateEvent</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span><span class="n">password</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When the login fragment is resumed, otto automatically subscribes the fragment to the bus.  When it is paused, it unsubscribes.  This is awesome, because if a request is initiated to the API, but then the fragment is closed before the rest api responds, we don&rsquo;t have the fragment still listening for that response.</p>

<h2>Conclusion</h2>

<p>Otto and retrofit play really nicely together and are great tools for building an android app.  Managing all of the events can get a bit ugly, so be careful how you name them and organize them in the project.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Kevin Coleman -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  








  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
