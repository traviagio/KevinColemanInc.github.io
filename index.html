
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Kevin Coleman</title>
  <meta name="author" content="Kevin Coleman">

  
  <meta name="description" content="I found a few minutes today to finally add search to Atlanta Startup Jobs. I had been putting it off for a long time, thinking it would be a long &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.kcoleman.me">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Kevin Coleman" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
<!--- MathJax Configuration -->
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-48081941-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Kevin Coleman</a></h1>
  
    <h2>I am a software engineer at Spark Start with interests in start ups, web apps, and wearables.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscribe" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 13.310204,73.332654 C 5.967347,73.332654 0,79.322448 0,86.621428 c 0,7.338776 5.967347,13.262246 13.310204,13.262246 7.370408,0 13.328572,-5.92245 13.328572,-13.262246 0,-7.29898 -5.958164,-13.288774 -13.328572,-13.288774 z M 0.01530612,33.978572 V 53.143878 C 12.493878,53.143878 24.229592,58.02347 33.068368,66.865306 41.894898,75.685714 46.767346,87.47449 46.767346,100 h 19.25 C 66.017346,63.592858 36.4,33.979592 0.01530612,33.978572 l 0,0 z M 0.03877552,0 V 19.17449 C 44.54796,19.17551 80.77551,55.437756 80.77551,100 H 100 C 100,44.87653 55.15102,0 0.03877552,0 z"></path></svg></a></li>
  
</ul>
  
  
  
  
  
<ul class="subscribe">
  <li><a href="https://github.com/KevinColemanInc" rel="subscribe-github" title="@KevinColemanInc on GitHub"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 50,0 C 22.385714,0 0,22.385714 0,50 0,77.614286 22.385714,100 50,100 77.614286,100 100,77.614286 100,50 100,22.385714 77.614286,0 50,0 z m 29.692858,79.692858 c -3.859184,3.859182 -8.351022,6.887754 -13.35,9.00306 -1.27041,0.536736 -2.560204,1.009184 -3.867348,1.415306 v -7.493878 c 0,-3.938774 -1.35102,-6.835714 -4.053062,-8.690816 1.692858,-0.163264 3.24694,-0.390816 4.663266,-0.683672 1.416326,-0.292858 2.913266,-0.716328 4.491838,-1.27041 1.57857,-0.55408 2.994896,-1.213264 4.247958,-1.97755 1.253062,-0.765306 2.458164,-1.758164 3.613266,-2.978572 1.155102,-1.220408 2.12449,-2.604082 2.905102,-4.15 0.780612,-1.545918 1.4,-3.40204 1.855102,-5.566326 0.455102,-2.164286 0.683674,-4.54898 0.683674,-7.153062 0,-5.045918 -1.643878,-9.341836 -4.931634,-12.890816 C 77.44796,33.35 77.285714,29.10204 75.463266,24.512244 l -1.22143,-0.145918 c -0.845918,-0.09796 -2.368366,0.260204 -4.565306,1.07449 -2.196938,0.814286 -4.663264,2.14796 -7.396938,4.004082 -3.87449,-1.07449 -7.893878,-1.611224 -12.061224,-1.611224 -4.19898,0 -8.203062,0.536734 -12.012246,1.611224 -1.72449,-1.17245 -3.361224,-2.139796 -4.907142,-2.905102 C 31.753062,25.77449 30.516326,25.254082 29.587756,24.97653 28.660204,24.7 27.79796,24.528572 27,24.463266 c -0.79796,-0.0653 -1.310204,-0.08062 -1.537756,-0.04898 -0.22755,0.03164 -0.390816,0.0653 -0.487754,0.09796 -1.82347,4.62245 -1.985714,8.87143 -0.487756,12.743878 -3.287754,3.54796 -4.931632,7.844898 -4.931632,12.890816 0,2.604082 0.227552,4.988776 0.683674,7.153062 0.456122,2.164286 1.07449,4.020408 1.855102,5.566326 0.780612,1.545918 1.75,2.929592 2.905102,4.15 1.155102,1.220408 2.360204,2.213266 3.613264,2.978572 1.253062,0.766326 2.669388,1.42449 4.24796,1.97755 1.578572,0.554082 3.07551,0.976532 4.491836,1.27041 1.416328,0.292856 2.970408,0.521428 4.663266,0.683672 -2.669388,1.82347 -4.004082,4.720408 -4.004082,8.690816 v 7.639796 C 36.536734,89.818368 35.083674,89.3 33.656122,88.695918 c -4.99898,-2.115306 -9.490816,-5.143878 -13.35,-9.00306 -3.859184,-3.859184 -6.887754,-8.351022 -9.00306,-13.35 C 9.1163263,61.171428 8.0071428,55.67347 8.0071428,50 c 0,-5.67347 1.1091835,-11.171428 3.2969392,-16.342858 2.115306,-4.998978 5.143878,-9.490816 9.00306,-13.35 3.859184,-3.859182 8.351022,-6.887754 13.35,-9.00306 C 38.828572,9.1163266 44.32653,8.0071428 50,8.0071428 c 5.67347,0 11.171428,1.1091838 16.342858,3.2969392 5,2.115306 9.490816,5.143878 13.35,9.00306 3.859182,3.859184 6.887754,8.351022 9.00306,13.35 2.186736,5.17245 3.295918,10.67041 3.295918,16.342858 0,5.672448 -1.109182,11.171428 -3.296938,16.342858 -2.115306,4.998978 -5.143878,9.490816 -9.00204,13.35 l 0,0 z"></path></svg></a></li>
</ul>
  
  
  
  
  
<ul class="subscribe">
  <li><a href="https://plus.google.com/+KevinColemanInc" rel="publisher" title="Google+ Profile"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 23.03264,55.19021 C 32.01805,55.457578 38.046082,46.137447 36.495958,34.370183 34.943794,22.603939 26.398215,13.161349 17.411784,12.89296 8.4253533,12.625592 2.3973217,21.630392 3.9494863,33.400718 5.5006303,45.164921 14.043148,54.921821 23.03264,55.19021 z M 99.99898,24.999027 100,0 -0.00797206,0 0.0052943,16.202408 C 5.7047282,11.184661 13.611481,6.9914696 21.771315,6.9914696 c 8.721103,0 34.888495,0 34.888495,0 l -7.807765,6.6035874 -11.062106,0 c 7.33732,2.81349 11.246815,11.3407 11.246815,20.090377 0,7.348545 -4.082979,13.667416 -9.852826,18.161652 -5.629021,4.385043 -6.696453,6.220904 -6.696453,9.948752 0,3.180866 6.030073,8.594563 9.183386,10.81923 9.217061,6.498477 12.199952,12.530591 12.199952,22.603843 0,1.604209 -0.198996,3.206378 -0.591884,4.780993 L 100,100 c 0,0 0,-46.594917 0,-68.751495 l -18.750474,0 0,18.750475 -6.250499,0 0,-18.750475 -18.750474,0 0,-6.250498 18.750474,0 0,-18.7494538 6.250499,0 0,18.7494538 18.750474,0 z M 18.147557,74.798916 c 2.111393,0 4.04522,-0.05817 6.048441,-0.05817 -2.651232,-2.571634 -4.749358,-5.722905 -4.749358,-9.606889 0,-2.305285 0.738834,-4.52485 1.77157,-6.496436 -1.053145,0.0745 -2.127721,0.09695 -3.234952,0.09695 -7.261803,0 -13.4286215,-2.351208 -17.99020957,-6.236212 l 0,6.56685 0.00102048,19.70055 C 5.2128523,76.28781 11.409265,74.798916 18.147557,74.798916 z M 44.474145,93.051391 C 43.002599,87.308076 37.788918,84.46091 30.518951,79.420713 c -2.644088,-0.85313 -5.556565,-1.35521 -8.681304,-1.387866 -8.752739,-0.09389 -17.2452523,3.525266 -21.84561906,8.743028 l 0,13.224125 44.64641606,-0.0011 c 0,0 0.263286,-2.21038 0.263286,-3.362512 -10e-4,-1.222547 -0.151032,-2.419581 -0.427585,-3.58498 z"></path></svg></a></li>
</ul>
  
  
  
    
      <form action="http://google.com/search" method="get">
        <fieldset role="search">
          <input type="hidden" name="q" value="site:www.kcoleman.me" />
    
          <input class="search" type="text" name="q" results="0" placeholder="Search"/>
        </fieldset>
      </form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/coleman-laws">Coleman Laws</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/06/adding-search-to-atlanta-startup-jobs/">Adding Search to Atlanta Startup Jobs</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-06T08:23:14-04:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:23 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/czech_1.jpg" title="Adding search to Atlanta Startup Jobs" class="banner-img"/></p>

<p>I found a few minutes today to finally add search to <a href="http://atlantastartupjobs.com">Atlanta Startup Jobs</a>.  I had been putting it off for a long time, thinking it would be a long laborous process, but I found it was shockingly easy.  Here is what I did:</p>

<h2>Install pg_search</h2>

<p>The two leading gems that drive postgress fulltext search are <a href="https://github.com/Casecommons/pg_search">pg_search</a> and <a href="https://github.com/textacular/textacular">textacular</a>.  I went with pg_search, because it has more love on github.</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;pg_search&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and run bundle</p>

<figure class='code'><figcaption><span>console</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">  bundle</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Modify model</h2>

<p>For the models you want to search, add <code>include PgSearch</code> to the top of them in order to enable the pg_search DSL.  Since <a href="http://atlantastartupjobs.com">Atlanta Startup Jobs</a> only has one searchable model (job_posts), I include this line in the model:</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">pg_search_scope</span> <span class="ss">:search_generic</span><span class="p">,</span> <span class="ss">:against</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:company_name</span><span class="p">,</span> <span class="ss">:description</span><span class="o">]</span><span class="p">,</span> <span class="ss">:order_within_rank</span> <span class="o">=&gt;</span> <span class="s2">&quot;created_at DESC&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I included the &ldquo;order_within_rank&rdquo;, to protect the order across different pages, since postgres randomly ranks items with equivalent rank score.</p>

<h2>Modify controller</h2>

<p>Here is what my search action looks like in my controller code:</p>

<figure class='code'><figcaption><span>job_posts_controller</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">search</span>
</span><span class='line'>  <span class="vi">@job_posts</span> <span class="o">=</span> <span class="no">JobPost</span><span class="o">.</span><span class="n">search_generic</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:q</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">page</span> <span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span>
</span><span class='line'>  <span class="n">render</span> <span class="ss">:index</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/03/rails-patterns-builders-and-models/">Rails Patterns: Builders and Models</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-03T03:23:38-04:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>3:23 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/sf-bridge.jpg" title="Rails Patterns: Builders and Models" class="banner-img"/></p>

<p>A huge problem with ruby on rails apps is many of them end with overly cluttered models and controller methods. An attempt to solve this would be to move what you can to your active record models, but then you end up with heavily bloated model classes that extend way beyond their intended active record design patterns.  Active record models should just manage the communication between the rails app and the database.  Anything else is just code smell.</p>

<p>In all of my experience with rails projects, I found that my active record models typically ended up having a group of methods that helped me create the model itself (think when you create a user, you also need to create a user_profile or if you want to find or create a model).</p>

<h1>Builders</h1>

<p>You can easily break this type of code away from the model by following a builder pattern. Builder patterns are great for creating objects with business logic based on given parameters.  It adds an easy way to add business logic to model creation without adding bloat to your active record model class.</p>

<p>To follow this pattern, create a directory called <code>builders</code> in the <code>/models</code> directory.</p>

<p>Here is an example of my user class before and after a refactor with the builder pattern.</p>

<p>before:</p>

<figure class='code'><figcaption><span>user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_admin_user</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_or_create_by</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">user</span><span class="o">.</span><span class="n">add_role</span> <span class="ss">:admin</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_staff_user</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_or_create_by</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">user</span><span class="o">.</span><span class="n">add_role</span> <span class="ss">:staff</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_user_with_invite</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_or_create_by</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">user</span><span class="o">.</span><span class="n">send_invitation</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>after:</p>

<figure class='code'><figcaption><span>user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1"># nothing to see here</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>/builders/user_builder.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">Builders</span><span class="o">::</span><span class="no">UserBuilder</span>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_admin_user</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span>
</span><span class='line'>      <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_or_create_by</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span><span class='line'>      <span class="n">user</span><span class="o">.</span><span class="n">add_role</span> <span class="ss">:admin</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_staff_user</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span>
</span><span class='line'>      <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_or_create_by</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span><span class='line'>      <span class="n">user</span><span class="o">.</span><span class="n">add_role</span> <span class="ss">:staff</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_user_with_invite</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span>
</span><span class='line'>      <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_or_create_by</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span><span class='line'>      <span class="n">user</span><span class="o">.</span><span class="n">send_invitation</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Non-AR models</h1>

<p>Models also can get bloated with controller-like actions that have groups of methods that should be broken out into their own classes that the controllers will leverage.  An example of this type of class would be one that manages to send an email to a user.  These models don&rsquo;t extend active record, because they focus is performing business logic on active_record models, not storing them in the database.  Models take in a limited scope of the Params of a request, perform their function, and then return their results to the controller.</p>

<p>Before breaking out email sending, active record models would end up with a collection of email sending methods (send_password_reset, send_notification, etc). All of these should be moved to a model classes because classes have one purpose and active record models are for Savin data, not sending emails.</p>

<p>An example of this could be:</p>

<figure class='code'><figcaption><span>user_invitor.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">UserInvitor</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">invite_email</span> <span class="n">email</span>
</span><span class='line'>      <span class="no">Invitation</span><span class="o">.</span><span class="n">create</span> <span class="ss">email</span><span class="p">:</span> <span class="n">email</span>
</span><span class='line'>      <span class="no">UserMailer</span><span class="o">.</span><span class="n">invite_email</span><span class="p">(</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_later</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/07/Ruby-on-Rails-Grape-gem/">Ruby on Rails Grape Gem: Pros and Cons</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-07T04:36:51-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:36 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/grapes.jpeg" title="Ruby on Rails Grape gem" class="banner-img" /></p>

<p>Ruby on Rails is a very powerful framework that is awesome at building RESTful APIs.  Using vanilla rails to build an API, while completely possible, is not always the best way to go.  <a href="https://github.com/intridea/grape">Grape</a> is micro-api framework design to work along side rails for developing an RESTful API.</p>

<p>Grape has some very <a href="https://github.com/intridea/grape/blob/master/README.md">expansive documentation</a> describing how the gem works, so I am not going to dive too deeply into that</p>

<h2>Pros</h2>

<p>Starting off with the positives: grape is great a creating and maintaining documentation.  I love the <a href="https://github.com/tim-vandecasteele/grape-swagger">grape-swagger</a> gem allows you to easily generate documentation from you existing code base.  Since the documentation is generated, all of the code is self-documenting and you don&rsquo;t have to maintain <a href="http://raml.org/">separate API documentation files</a>.</p>

<p>Because grape has its own <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>, it makes creating APIs easy to read and understand.  This makes the code base easier to maintain for future improvements.  Plus it has its own opinion for how to create an API, which really help keep your codebase consistent.</p>

<p>grape gives you a uniform way to control API HTTP Headers.  Rather than having to roll your own classes to manage the response headers, grape makes it easy to set them.</p>

<h2>Cons</h2>

<p>Because grape is independent of rails, it takes a bit of finagling for it to play well with rails.  You have to manually include rails libraries like ActiveRecord or ActiveSupport.  Since there is no ActiveSupport, it makes caching responses more difficult than it should be.</p>

<p>Because grape has its own DSL, there is a bit of a learning curve to understand how it wants you to create an API.  If you have a firm understanding of ruby, it shouldn&rsquo;t be that difficult for you to pick up, but it definitely takes a bit of getting used to.</p>

<p>While grape makes it easier to read and write your api, it does add another layer of complexity to your rails application.</p>

<h2>Conclusion</h2>

<p>For now, I am going to stick with rolling my own APIs using &ldquo;just&rdquo;* the rails framework.  Being more pure rails, gives me more control over the api had has less &ldquo;magic.&rdquo;  If I need to bring on a new developer, they will not have to spend as much time getting up to speed on this new library.</p>

<p>Plus, vanilla rails has an awesome caching tools that don&rsquo;t need to be arm wrestled into the framework.</p>

<ul>
<li>By &ldquo;just&rdquo; I mean, standard gem stack provided in rails 4.2 with typical basic additions I would use in both grape and vanilla rails.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/12/android-app-architecture/">Otto Meet Retrofit: How to Build a Scalable and Performant Android Application</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-12T15:46:43-04:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:46 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/beach2.jpg" title="Otto meet Retrofit: How to build a scalable and performant Android application" class="banner-img"  /></p>

<p>Unlike Ruby on Rails, Android app development does not have as definitive of an opinion on how apps should be developed and so we have designed our own pattern leveraging open source tools like <a href="http://square.github.io/otto/">Otto</a> and <a href="http://square.github.io/retrofit/">Retrofit</a> to design our applications.</p>

<p>After much research, we at <a href="http://sparkstart.io">Spark Start</a> invested in developing a design pattern for our client applications that leverages the best practices.  Jumping right in here:</p>

<h2>Consuming a RESTful API</h2>

<p>Following Object Oriented Programming&rsquo;s best practices, all objects should each only have one job.  With the start of a new api, create a folder with the name of the API you are trying to consume.</p>

<p>Inside of your client.java file, you will include your retrofit interface classes.  This file will specify how your app will be calling the API.</p>

<figure class='code'><figcaption><span>APIClient.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">APIClient</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">interface</span> <span class="nc">IUser</span> <span class="o">{</span>
</span><span class='line'>        <span class="nd">@GET</span><span class="o">(</span><span class="s">&quot;/users/Me.json&quot;</span><span class="o">)</span>
</span><span class='line'>        <span class="kt">void</span> <span class="nf">getMe</span><span class="o">(</span><span class="n">Callback</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">callback</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@GET</span><span class="o">(</span><span class="s">&quot;/users.json&quot;</span><span class="o">)</span>
</span><span class='line'>        <span class="kt">void</span> <span class="nf">getUsers</span><span class="o">(</span><span class="n">Callback</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="n">callback</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This keeps all of our API information in one small maintainable file.  Notice how we are always using the retrofit callback method instead of the async call.  This will allow our code to start a web request on any thread.  Now the code consuming this will never have to worry about thread locking.</p>

<figure class='code'><figcaption><span>APIManager.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">APIManager</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Bus</span> <span class="n">mBus</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">CooleafAPIManager</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Bus</span> <span class="n">bus</span><span class="o">)</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="n">mBus</span> <span class="o">=</span> <span class="n">bus</span><span class="o">;</span>
</span><span class='line'>        <span class="n">mAsyncRestAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RestAdapter</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
</span><span class='line'>                <span class="o">.</span><span class="na">setEndpoint</span><span class="o">(</span><span class="n">API_URL</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">setRequestInterceptor</span><span class="o">(</span><span class="n">getCookieInterceptor</span><span class="o">())</span>
</span><span class='line'>                <span class="o">.</span><span class="na">setLogLevel</span><span class="o">(</span><span class="n">RestAdapter</span><span class="o">.</span><span class="na">LogLevel</span><span class="o">.</span><span class="na">BASIC</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Subscribe</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoadAuthenticateEvent</span><span class="o">(</span><span class="n">LoadAuthenticateEvent</span> <span class="n">loadAuthenticateEvent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">String</span> <span class="n">email</span> <span class="o">=</span> <span class="n">loadAuthenticateEvent</span><span class="o">.</span><span class="na">getEmail</span><span class="o">();</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">loadAuthenticateEvent</span><span class="o">.</span><span class="na">getPassword</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Callback</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">callback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;()</span> <span class="o">{</span>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">success</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span> <span class="n">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">mBus</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="nf">LoadedMeEvent</span><span class="o">(</span><span class="n">user</span><span class="o">));</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">failure</span><span class="o">(</span><span class="n">RetrofitError</span> <span class="n">retrofitError</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">mBus</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="nf">LoadedErrorEvent</span><span class="o">(</span><span class="n">retrofitError</span><span class="o">));</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">};</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">sClient</span><span class="o">.</span><span class="na">authenticate</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">password</span><span class="o">,</span> <span class="n">deviceID</span><span class="o">,</span> <span class="n">callback</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The manager class acts as a middleware between the client and the rest of our application.  For our <a href="http://cooleaf.com">most recent application</a>, authentication is handled by cookies, so we had to create our own cookie interceptor to handle authentication.</p>

<p>The manager class subscribes to the bus and watches for events that request an API call.  When a user needs to authenticate, it catches the event, creates a callback which will intern fire off a new event once the response is finished.</p>

<h2>Hooking in Otto into the controller classes</h2>

<p>Otto is a great tool for managing async task events.  It has an event bus that you subscribe and unsubscribe your fragments and activities to, so when a callback (e.g. Retrofit is finished with a request), they can process the response.</p>

<figure class='code'><figcaption><span>LoginFragment.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>       <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
</span><span class='line'>       <span class="n">BusProvider</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
</span><span class='line'>        <span class="n">BusProvider</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">unregister</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">onLoginClick</span><span class="o">()</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="n">BusProvider</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="nf">LoadAuthenticateEvent</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span><span class="n">password</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When the login fragment is resumed, otto automatically subscribes the fragment to the bus.  When it is paused, it unsubscribes.  This is awesome, because if a request is initiated to the API, but then the fragment is closed before the rest api responds, we don&rsquo;t have the fragment still listening for that response.</p>

<h2>Conclusion</h2>

<p>Otto and retrofit play really nicely together and are great tools for building an android app.  Managing all of the events can get a bit ugly, so be careful how you name them and organize them in the project.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/12/atlanta-startup-jobs/">Atlanta Startup Jobs - Scratch Your Own Itch</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-12T20:52:21-05:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:52 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/park.jpg" title="Atlanta Startup Jobs - Scratch your own itch" class="banner-img"  /></p>

<p>I have always wanted to start my own business, ever since I was in high school. Since then, I have been struggling to find an idea that I am truly passionate enough to invest my time or resources to execute on my own.</p>

<p>So I decided I graduated from Georgia Tech in ‘11, I decided I should do the second best thing: work for someone that is starting their own business. This is a great technique because it reduces your risk (get paid a /mostly/ competitive salary) and gives you an opportunity to learn (make mistakes on someone else’s dollar :-))</p>

<p>While Atlanta has an awesome startup culture unless you are familiar with the big players (co-working spaces, syndications, meetup groups), it can be difficult finding what companies are hiring. The Georgia Tech BuzzBoard only has postings by big name companies that can afford the hefty price tag. Same can be said about the popular job board sites like CareerBuilder.com or Monster.com.</p>

<p>Fast forward a few years and I finally figured out who to talk to and where to look for a startup job postings. But the experience was still frustrating because now I was checking 3-5 different job board websites for the various co-working and syndication websites.</p>

<p>There was no one place to find these jobs.</p>

<p>So I made <a href="http://www.atlantastartupjobs.com">Atlanta Startup Jobs</a></p>

<p>Atlanta Startup Jobs aggregates job postings from all of Atlanta’s job board websites automatically each night. Then every Friday, it emails out to the subscriber list all of the jobs it found over the last week.</p>

<p>The app is written in Ruby on Rails and hosted for free on Heroku. I use a separate application instance on Heroku (still free tier) to crawl the websites so the crawler gets its own set of dyno ours from the web application.</p>

<p>Since its launch 3 months ago, it has found over 350 job postings and gets on average 100 hits per day with a list of 60 subscribers.</p>

<p>If you are looking for a job in Atlanta’s startup community, Atlanta Startup Jobs is the place to start.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/08/happybeam/">SideProject: HappyBeam - Meditate and Improve</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-08T13:11:59-05:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:11 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/HappyBeam-feature-graphic.png" title="SideProject: HappyBeam - Meditate and improve" class="banner-img"  /></p>

<h3>Please Vote for us!!</h3>

<h1>Happiness Apps Challenge</h1>

<p>Side projects are some of the best way for developers to learn new skills and maybe a little cash :-).  I really enjoy attending <a href="/blog/2014/10/26/how-to-win-a-hackathon/">Hackathon&rsquo;s</a>, because they really push my skillset as a developer.</p>

<p>Most of my recently hackathons have required I learned android development, so I decided for my next project to buckle down and make a nicely designed, complicated android app.  The HappinessApps challenge was the perfect excuse for me to build an app worthy of my portfolio.</p>

<p>For the HappinessApps hackathon, <a href="http://kcoleman.me">Kevin Coleman</a> and Haider Khan interviewed 57 unhappy people via Mechanical Turk that used to meditate.  We wanted to know why they stopped meditating.  32 users felt frustrated with meditation, because they never felt like they were getting any better and weren&rsquo;t confident that meditation was improving their happiness.</p>

<h1>Enter <a href="http://www.happybeamapp.com">HappyBeam</a></h1>

<p>&ldquo;If you can&rsquo;t measure it, you can&rsquo;t improve it.&rdquo; -Peter Drucker</p>

<p>HappyBeam is the first app that is specifically designed to measure your inner peace by building up the bridge between physical movements and mental fluctuations. It helps you have a peaceful mind, reduce stress and depression, and improves your meditations. The less movement and lower the score that HappyBeam detects, the more you improve.</p>

<p>HappyBeam runs alongside meditation apps to measure how a user moves during a meditation.  The app calculates a movement score using a cutting-edge algorithm. Happy-peaceful scores are marked green, not-so-good scores are yellow, high-anxiety scores are red.</p>

<p>In the &ldquo;Your Meditations Chart&rdquo;, users see their improving meditation scores across all their meditations. The history list shows a list of each session with a chart displaying when and how long they moved.</p>

<p>Currently, there is no other meditation apps that shows how a user is improving.</p>

<p>HappyBeam leverages the latest Android Wear technology so that users can measure motion with their smartwatch.  This delivers a better reading of their meditation.</p>

<p>HappyBeam was built in 3 weeks for the Happiness Apps challenge.</p>

<p><a href="http://www.happybeamapp.com">Website</a></p>

<p><a href="https://play.google.com/store/apps/details?id=zkhaider.com.happinessproject">Android Play Store</a>​</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/26/how-to-win-a-hackathon/">How to Win a Hackathon</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-10-26T20:14:40-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:14 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/cooking.jpg" title="How to win a hackathon" class="banner-img"  /></p>

<p>I have been to a few hackathons and startup weekends over the last few years and I have a pretty good prize rate (I have placed at more than 50% of the events).  After my back to back win of the ATT and FinApps hackathons, I want to share my thoughts on what it takes to be a winning team.</p>

<p><img src="/images/check.jpg" title="Winning Team at the ATT hackathon" style="display: block; margin-left: auto; margin-right: auto; width:35%;" /></p>

<h1>The best prize is the easiest</h1>

<p>Your first goal of each event though should be building out your network.  I have met some very interesting individuals (a VC, and awesome developers and designers, etc.) by attending these events.  Meeting other smart and talented like-minded people is infinitely more valuable (and easier to obtain) than any monetary prize.</p>

<p>I try to avoid grouping with people that I already know, because I want to find people I will work with again in the future.  My friends are known variables.  While awesome, I want to see who else is awesome to work with.</p>

<h1>Winning the competition</h1>

<p><img src="/images/att.jpg" title="Winning Team at the ATT hackathon" style="display: block; margin-left: auto; margin-right: auto;" /></p>

<h2>The Team</h2>

<p>First and foremost, as with starting a company, building a software product, or pretty much any other group activity, you need to have a solid team.</p>

<p>There are two types of people on a good Hackathon team: The Coder and The Presenter.</p>

<p>The coders have the easiest job.  They have to develop a working prototype in 18 hours.  Good coders can work independently and solve problems they run into quickly.</p>

<p>Coders have to deliver.  It is more important to have a simple 100% finished product than an advanced 80% finished product.  During the presentation, don&rsquo;t make the judges put on their imagination hats and tell them what you could of done if you <em>insert lame excuse here</em>.</p>

<p>You need one presenter and that person needs to be awesome at public speaking.  Typically they will also provide product development guidance.  The good presenter is just as valuable as a good coder, if not more.</p>

<p>I have seen judges destroy teams without solid presenters during questioning.  Some judges will ask some really hard questions and you have to have someone be able to deliver awesome answers on the fly.</p>

<p>An example of this was at the FinApps hackathon, a judge asked us how we secured our application.</p>

<p>Rather than saying, &ldquo;oh, uhh&hellip; that is a good point. we didn&rsquo;t think of that&rdquo;.  Our presenter said, &ldquo;Our goal for this hackathon was deliver a functioning credit card selector to accomplish one of the goals laid out by the hackathon.  We have strategies for adding security into the project, but it was not a target for our team.&rdquo;</p>

<h2>The Idea</h2>

<p>You need to have an idea that is a tiny bit sexy, flexible, and a lot do-able.</p>

<p>You don&rsquo;t have to bring your own idea, but having one definitely help.  I am not very creative and I typically join other teams.  My first requirement for a team is not if I like their idea, but if I think they have a solid presenter.</p>

<p>I have seen teams enter the competition with an idea, but end up finding out it was physically impossible to execute that idea.  Don&rsquo;t be married to one concept.  13 teams registered for the FinApp&rsquo;s $30,000 prize and only 7 presented.  A big issue was that there wasn&rsquo;t a hardware means of executing their ideas and they ended up going home.</p>

<p>Your idea should easily be understood in 5 minutes or less by a panel of non-technical judges.</p>

<p>Please make sure you have the skillset and the time to execute your idea.  Many teams end up not being able to accomplish anything during a weekend because they were missing a developer, couldn&rsquo;t get it to work, or ran out of time.</p>

<p>I have seen many teams get up there and say &ldquo;hey, everyone reach under your seats and pull out that imagination hat that I put under your seat, because I didn&rsquo;t get anything done this weekend except this 5 min power point presentation.&rdquo;</p>

<h2>Coder Preparation</h2>

<p>Technically you are not allowed to do this before most hackathon events.  Organizers require all work to be at the competition.  But I think there are still a few things you can &lsquo;legally&rsquo; do to help improve your chances of winning.</p>

<p>If you know you are going to work with a certain technology, set up your environment before hand.  Don&rsquo;t go to the hackathon needing to install android studio, ruby on rails, or whatever technology stack you plan on using.  As with any installation, there will be headaches that you should solve before the competition.</p>

<p>If you are working with hardware or an API, make sure your machine can deploy to this hardware before you arrive at the competition.  Many teams loose hours of coding time trying to communicate with a device or API unnecessarily.</p>

<h2>The Presentation</h2>

<p>This is where many teams mess this up.  I have seen some really awesome presentations by people that don&rsquo;t have that impressive of a product and I have seen some terrible presentations by people that could of had a good product.</p>

<p>If you don&rsquo;t have a presenter, please go learn some basic presentation skills.</p>

<h3>Presentation Tips</h3>

<ul>
<li>Don&rsquo;t go up there to show off source code.</li>
<li>Focus on what you accomplished, not what you could do if you had the right resources.</li>
<li>Test your application over and over before presenting.  Don&rsquo;t let it crash!</li>
<li>The basic format should be

<ul>
<li>Introduction of members</li>
<li>Problem you tried to solve</li>
<li>How you solved the problem</li>
<li>Demonstration of the prototype</li>
</ul>
</li>
<li>Be funny.  Start of with a Joke or a &ldquo;ask the audience&rdquo; question like &ldquo;How many of you have this problem?&rdquo;</li>
</ul>


<h1>Closing</h1>

<p><img src="/images/business_card.jpg" title="Spark Starter Business Card" style="display: block; margin-left: auto; margin-right: auto; width:50%;" /></p>

<p>Don&rsquo;t forget to bring business cards! Remember this event should be about the networking and not the prize.</p>

<p>Be sure to communicate with everyone you talk with what your skillset is and what you are interested in.  This will help them understand how you can help them in the future (and how they can help you).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/09/one-rails-app-two-web-applications/">One Rails App Two Web Applications</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-10-09T20:11:45-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:11 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/mountains.jpeg" title="One Rails App Two Web Applications" class="banner-img"  /></p>

<p>When building a rails application, sometimes it is quicker to build one code base that is shared on two completely different frontend applications.  I am going to discuss the design approaches I used to segregate the two rails websites within a single rails application base.</p>

<h2>Configuring the Front End</h2>

<p>My first &lsquo;trick&rsquo; is to build the system such that all interactions are run through an RESTful API.  This gives one surface area for applications (front end apps or mobile or whatever) and it reduces the amount of duplication that maybe experienced across the two different websites.</p>

<p>For my projects, I lean towards AngularJS, mainly because there is a strong community backing the technology, not to mention this is one of Google&rsquo;s babies.</p>

<p>Both of these websites will have a unique look and feel as well as style sheets and html designs.</p>

<h3>Break apart the CSS files</h3>

<p>I divided my assets/stylesheets folder to look like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  assets/stylesheets/application.css
</span><span class='line'>  assets/stylesheets/app1/app1.css
</span><span class='line'>  assets/stylesheets/app2/app2.css</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>application.css</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="c">/*</span>
</span><span class='line'><span class="c"> *= require_self</span>
</span><span class='line'><span class="c"> */</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note how I removed the standard <code>require_tree .</code> line to prevent it from auto loading the entire project.  I just want it to load global attributes for the two applications.</p>

<figure class='code'><figcaption><span>app1.css.scss</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="k">@import</span> <span class="s2">&quot;compass/reset&quot;</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;compass&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;app1/partials/variables&quot;</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;app1/partials/typography&quot;</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;app1/partials/footer&quot;</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;app1/partials/alerts&quot;</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;app1/partials/buttons&quot;</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;app1/partials/sprites&quot;</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;app1/partials/navigation&quot;</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;app1/partials/modals&quot;</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;app1/partials/framework_and_overrides&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;app1/pages/bootstrap_override&quot;</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;app1/pages/questions&quot;</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;app1/pages/content&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here I am explicitly including the app1.css resources in app1.</p>

<p>application.css will include styling that is shared between the two applications.  An example, might be your frameworks like bootstrap.</p>

<p>appN.css will include the styles that are unique to your web application.  You should create an /assets/stylesheets/app1/ folder to house all of your style sheets for that specific app.</p>

<p>In my layouts view, you will only want to be loading app1 and application when a user requests an app1 website and app2 and application when the user requests an app2 website.</p>

<p>By checking the request host, you can determine the domain the user is on you can decide which css files need to be delivered to the client.  The host check should be offloaded to a helper method that would like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">app1?</span>
</span><span class='line'>    <span class="s1">&#39;app1.com&#39;</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">host</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the rails views layout folder, you only include the style sheets that are used</p>

<figure class='code'><figcaption><span>layout.html.slim</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">==</span> <span class="n">stylesheet_link_tag</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;all&#39;</span>
</span><span class='line'><span class="o">-</span> <span class="k">if</span> <span class="n">app1?</span>
</span><span class='line'>  <span class="o">==</span> <span class="n">stylesheet_link_tag</span> <span class="s2">&quot;app1&quot;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;all&#39;</span>
</span><span class='line'><span class="o">-</span> <span class="k">elsif</span> <span class="n">app2?</span>
</span><span class='line'>  <span class="o">==</span> <span class="n">stylesheet_link_tag</span> <span class="s2">&quot;app2&quot;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s1">&#39;all&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You need to tell rails to precompile these new css files</p>

<figure class='code'><figcaption><span>config/initializers/assets.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">precompile</span> <span class="o">+=</span> <span class="sx">%w( app1.css app2.css )</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Javascript Divorce</h3>

<p>You can use a similar technique to break up your javascript files into two projects</p>

<figure class='code'><figcaption><span>layout.html.slim</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="o">==</span> <span class="n">javascript_include_tag</span> <span class="s1">&#39;application&#39;</span>
</span><span class='line'>  <span class="o">-</span> <span class="k">if</span> <span class="n">app1?</span>
</span><span class='line'>    <span class="o">==</span> <span class="n">javascript_include_tag</span> <span class="s1">&#39;app1&#39;</span>
</span><span class='line'>  <span class="o">-</span> <span class="k">elsif</span> <span class="n">app2?</span>
</span><span class='line'>    <span class="o">==</span> <span class="n">javascript_include_tag</span> <span class="s1">&#39;app2&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t forget to tell rails to precompile these new assets.</p>

<figure class='code'><figcaption><span>config/initializers/assets.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">precompile</span> <span class="o">+=</span> <span class="sx">%w( app1.js app2.js )</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Backend</h2>

<p>If you want to turn certain features on and off for certain applications, you should use the <a href="https://github.com/FetLife/rollout">rollout gem</a>.  It is a great tool for enabling and disabling features on the fly, or just completely locking up certain parts of the application.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/07/angularjs-rails-and-seo-part-2/">Angularjs Rails and SEO Part 2</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-10-07T20:26:43-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:26 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/beach.jpeg" title="Angularjs Rails and SEO Part 2" class="banner-img"  /></p>

<p>This is a continuation post from <a href="/blog/2014/10/03/angularjs-rails-seo/">Angularjs Rails and SEO Part 1</a>.</p>

<p>Now we need to configure Ruby on Rails to redirect Google&rsquo;s requests to get the non-ajax version of the page.  Google flags requests by replacing the &lsquo;#!&rsquo; in the url with <code>?_escaped_fragment_=</code> so you can know the route it is trying to fetch.</p>

<p>To catch this, we will add a <code>before_filter</code> to the application controller to watch for the <code>_escaped_fragment_</code> parameter.  This could will look like:</p>

<figure class='code'><figcaption><span>application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">protect_from_forgery</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">before_filter</span> <span class="ss">:catch_escaped_fragment</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">protected</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">catch_escaped_fragment</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">fragment</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:_escaped_fragment_</span><span class="o">]</span>
</span><span class='line'>      <span class="c1"># Build the original url</span>
</span><span class='line'>      <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">request</span><span class="o">.</span><span class="n">protocol</span><span class="si">}#{</span><span class="n">request</span><span class="o">.</span><span class="n">host_with_port</span><span class="si">}#{</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="n">url_with_hash</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">#!</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:_escaped_fragment_</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Render it with the PhantomJS script and return the result</span>
</span><span class='line'>      <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;phantomjs &#39;</span><span class="si">#{</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/lib/phantomjs/ember_to_static.js&#39; &#39;</span><span class="si">#{</span><span class="n">url_with_hash</span><span class="si">}</span><span class="s2">&#39; silence&quot;</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="sb">`</span><span class="si">#{</span><span class="n">command</span><span class="si">}</span><span class="sb">`</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">render</span> <span class="ss">text</span><span class="p">:</span> <span class="n">result</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This rails application controller code will trigger the phantomjs script we wrote in the previous blog post.  Since it asks to run it in silent mode, we can take the entire log output of the script (which should be the completed AngularJS application) and return that to google.</p>

<h2>Rails concurrency</h2>

<p>Because this methodology is blocking the thread request, when phantomjs tries to fetch the angularjs page, the website hangs. Because rails only executes one request at a time, phantomJS&rsquo;s request will sit and wait forever, since the request it is currently in will never finish.   To fix this, you will need to run your server with passenger.  Passenger can handle multiple requests in Ruby.</p>

<p>Add <code>gem 'passenger'</code> to your Gemfile. Then you can run it like this</p>

<p>and to run the application you can run <code>passenger -p 3000 -a 127.0.0.1</code>  if this is your first time running passenger with rails, you will have to follow an installation script.</p>

<p>Awesome! You are finished.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/03/angularjs-rails-seo/">Angularjs Rails and SEO Part 1</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-10-03T12:05:45-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>12:05 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/mountain.jpeg" title="Angularjs Rails and SEO Part 1" class="banner-img"  /></p>

<h2>Intro</h2>

<p>Today I was handed an interesting project around improve the SEO surface area of an <a href="https://angularjs.org/">AngularJS</a> SPA for a client.  After a bit of research on how to handle this, I decided that I should roll my own tool to solve this problem as it will give me greater flexibility later as opposed to going with a SaaS app like <a href="http://Prerender.io">Prerender.io</a>.</p>

<h2>Basic Concept</h2>

<p>Google says they are doing a much better job <a href="http://googlewebmastercentral.blogspot.com.es/2014/05/understanding-web-pages-better.html">rendering Javascript</a> on websites.  Awesome! But what about the <a href="http://bing.com">other</a> <a href="http://duckduckgo.com">guys</a>?</p>

<p>What we are going to do is leverage <a href="http://phantomjs.org/">PhantomJS</a> to render the angularjs code on the fly as the server requests the dynamic pages.  This way we don&rsquo;t have to deal with maintain a bunch of ERB files or pre-rendering static pages on our server.</p>

<p>The cost will be that the page load time will be a bit slower unfortunately and these requests will be expensive on memory, but we just want the fast (dev time-wise) solution to hit the ground.</p>

<h2>PhantomJS client</h2>

<p>First you need to <a href="http://phantomjs.org/download.html">install PhantomJS</a>.  If you are using Heroku to host your application, you will need to configure Heroku to run phantomjs with <a href="https://github.com/stomita/heroku-buildpack-phantomjs">this build back</a>.</p>

<p>Unfortunately there isn&rsquo;t a great way to detect when the page is finished loading.  My trick to solve this problem is for all of the controllers to set a status flag on the <code>body</code> tag noting they are finished running.  Now all of my controllers look like this:</p>

<figure class='code'><figcaption><span>app/assets/javascripts/app/controllers/index.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span> <span class="s">&#39;IndexCtrl&#39;</span><span class="p">,</span> <span class="nf">($scope, $rootScope) -&gt;</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'>  <span class="nv">$rootScope.status = </span><span class="s">&#39;ready&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and I have this on my <code>body</code> tag</p>

<figure class='code'><figcaption><span>app/views/layouts/application.html.slim</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'>  body data-status=&quot;{ { status } }&quot;
</span></code></pre></td></tr></table></div></figure>


<p>So now I can watch the data-status to see when angular has finished running.</p>

<p>Now lets create a angularjs-to-static.js.coffee file.  This will take in a URL and spit out the html for the page using PhantomJS.</p>

<figure class='code'><figcaption><span>lib/phantomjs/angularjs_to_static.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># angularjs_to_static.js.coffee</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># This script takes a URL as argument. (In that order!)</span>
</span><span class='line'><span class="c1"># The script then runs the Javascript on this page and waits until Ember has finished loading.</span>
</span><span class='line'><span class="c1"># It then renders the resulting static HTML page to the console.</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Keep track of whether the page has already been exported. The &#39;setTimeout&#39; mess might cause it to be exported multiple times.</span>
</span><span class='line'><span class="nv">exportPageContents = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="k">unless</span> <span class="nx">pageHasBeenExported</span>
</span><span class='line'>    <span class="nv">pageHasBeenExported = </span><span class="kc">true</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">page</span><span class="p">.</span><span class="nx">content</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Finished.&quot;</span> <span class="k">unless</span> <span class="nx">silence</span>
</span><span class='line'>    <span class="nx">phantom</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
</span><span class='line'>  <span class="k">return</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#wait until angularjs says its ready</span>
</span><span class='line'><span class="nv">waitForStatus = </span><span class="nf">(page, callback) -&gt;</span>
</span><span class='line'>  <span class="nv">expiration = </span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10000</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># try and fetch the desired element from the page</span>
</span><span class='line'>  <span class="nv">result = </span><span class="nx">page</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span>
</span><span class='line'>  <span class="p">)</span>
</span><span class='line'>  <span class="nx">system</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nx">writeLine</span> <span class="nx">result</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># if desired element found then call callback after 50ms</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">result</span>
</span><span class='line'>    <span class="nx">system</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nx">writeLine</span> <span class="s">&quot;- trigger found&quot;</span> <span class="k">unless</span> <span class="nx">silence</span>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span> <span class="p">(</span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nx">callback</span><span class="p">()</span>
</span><span class='line'>      <span class="k">return</span>
</span><span class='line'>    <span class="p">),</span> <span class="mi">50</span>
</span><span class='line'>    <span class="k">return</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># determine whether timeout is triggered</span>
</span><span class='line'>  <span class="nv">finish = </span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">()</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">finish</span> <span class="o">&gt;</span> <span class="nx">expiration</span>
</span><span class='line'>    <span class="nx">system</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nx">writeLine</span> <span class="s">&quot;- timed out&quot;</span> <span class="k">unless</span> <span class="nx">silence</span>
</span><span class='line'>    <span class="nx">callback</span><span class="p">()</span>
</span><span class='line'>    <span class="k">return</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># haven&#39;t timed out, haven&#39;t found object, so poll in another 100ms</span>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span> <span class="p">(</span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">waitForStatus</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">waitForStatus</span>
</span><span class='line'>    <span class="k">return</span>
</span><span class='line'>  <span class="p">),</span> <span class="mi">100</span>
</span><span class='line'>  <span class="k">return</span>
</span><span class='line'>
</span><span class='line'><span class="nv">fs = </span><span class="nx">require</span><span class="p">(</span><span class="s">&quot;fs&quot;</span><span class="p">)</span>
</span><span class='line'><span class="nv">system = </span><span class="nx">require</span><span class="p">(</span><span class="s">&quot;system&quot;</span><span class="p">)</span>
</span><span class='line'><span class="nv">page = </span><span class="nx">require</span><span class="p">(</span><span class="s">&quot;webpage&quot;</span><span class="p">).</span><span class="nx">create</span><span class="p">()</span>
</span><span class='line'><span class="nv">pageHasBeenExported = </span><span class="kc">false</span>
</span><span class='line'><span class="nv">script = </span><span class="kc">undefined</span>
</span><span class='line'><span class="nv">url = </span><span class="kc">undefined</span>
</span><span class='line'><span class="nv">silence = </span><span class="kc">undefined</span>
</span><span class='line'><span class="nv">script = </span><span class="nx">system</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="nx">system</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">or</span> <span class="nx">system</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">3</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Output usage info and exit.</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Usage: &quot;</span> <span class="o">+</span> <span class="nx">script</span> <span class="o">+</span> <span class="s">&quot; URL [silence]&quot;</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;  URL: address to open and run&quot;</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;  silence: enter &#39;silence&#39; (without quotes) to only output the page content and suppress info messages&quot;</span>
</span><span class='line'>  <span class="nx">phantom</span><span class="p">.</span><span class="nx">exit</span> <span class="mi">1</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>  <span class="nv">url = </span><span class="nx">system</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>  <span class="nv">silence = </span><span class="p">(</span><span class="nx">system</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">is</span> <span class="s">&quot;silence&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Will render &quot;</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span>  <span class="k">unless</span> <span class="nx">silence</span>
</span><span class='line'>  <span class="nx">page</span><span class="p">.</span><span class="nx">open</span> <span class="nx">url</span><span class="p">,</span> <span class="nf">(status) -&gt;</span>
</span><span class='line'>    <span class="k">unless</span> <span class="nx">status</span> <span class="o">is</span> <span class="s">&quot;success&quot;</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Unable to load URL!&quot;</span>  <span class="k">unless</span> <span class="nx">silence</span>
</span><span class='line'>      <span class="nx">phantom</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Start a long timeout. When the page still doesn&#39;t seem to have finished loading after 30s, something has likely gone wrong. This timeout prevents a hangup of the server.</span>
</span><span class='line'>      <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span> <span class="p">(</span><span class="nf">-&gt;</span>
</span><span class='line'>        <span class="nx">exportPageContents</span><span class="p">()</span>
</span><span class='line'>        <span class="k">return</span>
</span><span class='line'>      <span class="p">),</span> <span class="mi">30000</span>
</span><span class='line'>      <span class="nx">waitForStatus</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">exportPageContents</span>
</span><span class='line'>    <span class="k">return</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Side note</h3>

<p>Much of this script was borrowed from <a href="http://www.pieterjongsma.com/2013/01/11/ember-google-ajax-rails.html">Ember.js, Google Ajax crawling and Rails</a>, but I didn&rsquo;t like he was detecting with angularjs was finished.  He was waiting for the page to finish its server requests, added some padding time and then finished.  Waiting for the flag to be set is a better technique, because I know angular has finished.</p>

<p>Essentially this script takes in a URL, loads the page, and then waits for the flag to be set.  If the flag takes longer than 30s to be set, it bails and just renders what it has.  If you are on Heroku, you may need to shorten this flag to 15s, because <a href="https://devcenter.heroku.com/articles/request-timeout">Heroku has a request timeout</a> of 30s.</p>

<p><a href="/blog/2014/10/07/angularjs-rails-and-seo-part-2/">Part 2</a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Kevin Coleman -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  








  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
